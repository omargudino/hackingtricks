**COMPILACIÓN DE VULNERABILIDADES DEL KERNEL DE LINUX**

Los núcleos de Linux tienen una larga historia de vulnerabilidades de escalada de privilegios locales que permiten a los usuarios no privilegiados escalar sus privilegios a root.

En la mayoría de los casos estos exploits están disponibles en https://www.exploit-db.com/ desarrollados normalmente en c o c++.

Cosas a tomar en consideración antes de compilar:
* Validar que el exploit corresponde a la versión del kernel del equipo victima
* Leer, SI LEA las instrucciones iniciales del desarrollador ya que puede obtener detalles que deben ser incluidas en la compilación.
* Una vez compilado pruebelo en una maquina de prueba que contenga la misma versión del kernel.

Para compilar en c normalmente se usa gcc o cc, por lo que es importante identificar si nuestro equipo objetivo tiene gcc o cc instalado de lo contrario deberá instalarlo en una maquina de prueba compilarlo y subir el compilado a su objetivo (En algunos casos puede no funcionar por dependiencias no existentes en el target).

Voy a usar el ejemplo de dirtycow

    * (un)comment correct payload first (x86 or x64)!
    * $ gcc cowroot.c -o cowroot -pthread
    * $ ./cowroot
    * DirtyCow root privilege escalation
    * Backing up /usr/bin/passwd.. to /tmp/bak
    * Size of binary: 57048
    * Racing, this may take a while..
    * /usr/bin/passwd is overwritten
    * Popping root shell.
    * Don't forget to restore /tmp/bak
    * thread stopped
    * thread stopped
    * root@box:/root/cow# id
    * uid=0(root) gid=1000(foo) groups=1000(foo)

Como pueden ver en la linea:

    * $ gcc cowroot.c -o cowroot -pthread

Se indica claramente el proceso de COMPILACIÓN

* gcc -> Compilador
* cowroot.c -> Nombre del exploits
* -o -> Indica el archivo de salida
* -pthread -> crea un hilo adicional al proceso para evitar  corrupción o daños en el sistema de la victima dejándonos fuera.

**Compilación local VS remota**

Si el host remoto tiene instaladas herramientas de compilación como GCC, es mejor compilar el exploit en el host de destino. Esto puede ahorrarle problemas con paquetes faltantes, dependencias y variables específicas del sistema (como la arquitectura). Si el host objetivo no tiene las herramientas adecuadas disponibles para compilar exploits, entonces deberá compilar el exploit localmente en su casilla de ataque y luego transferir el exploit compilado al objetivo.

Antes de compilar el exploit, deberá asegurarse de que se cumplan todas las dependencias requeridas para el entorno host de destino. Por ejemplo, cuando el host de destino ejecuta un SO de 32 bits y su caja de ataque tiene un SO de 64 bits, debe instalar las versiones de 32 bits de todas las bibliotecas necesarias. Para exploits de compilación cruzada para una arquitectura de procesador diferente, puede instalar gcc-multilib (apt-get install gcc-multilib) y agregar -m32 para 32 bits o -m64 para 64 bits al comando de compilación.
